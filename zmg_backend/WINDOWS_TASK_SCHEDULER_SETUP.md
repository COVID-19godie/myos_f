# Windows 计划任务设置指南

## 概述
本指南将帮助你设置每周自动清理任务，删除7天前的资源文件。

## 前提条件
- 确保项目虚拟环境已正确配置
- 确保 logs 目录存在（已自动创建）

## 设置步骤

### 1. 验证批处理脚本
首先测试批处理脚本是否能正常工作：
```cmd
# 在项目根目录执行
d:\MyOS\zmg_backend\auto_clean.bat
```

检查 logs\cleanup.log 文件是否生成并有内容。

### 2. 打开计划任务程序
- 按 Win + R，输入 taskschd.msc
- 或者：控制面板 → 管理工具 → 任务计划程序

### 3. 创建基本任务
1. 点击右侧 "创建基本任务"
2. 名称：ZMG Weekly Cleanup
3. 描述：每周自动清理7天前的资源文件和数据库记录
4. 点击 "下一步"

### 4. 设置触发器
1. 选择 "每周"
2. 点击 "下一步"
3. 每周：选择你想要的频率（建议周日）
4. 开始：设置具体时间（建议凌晨3点）
5. 点击 "下一步"

### 5. 设置操作
1. 选择 "启动程序"
2. 点击 "下一步"
3. 程序或脚本：点击 "浏览" 并选择：
   D:\MyOS\zmg_backend\auto_clean.bat
4. 起始于(可选)：D:\MyOS\zmg_backend
5. 点击 "下一步"

### 6. 完成设置
1. 勾选 "当单击完成时，打开此任务属性的对话框"
2. 点击 "完成"

### 7. 高级设置（推荐）
在属性对话框中：
1. 勾选 "不管用户是否登录都要运行"
2. 勾选 "使用最高权限运行"
3. 在 "设置" 选项卡中：
   - 取消 "如果任务运行时间超过以下时间，停止任务"
   - 或者设置为足够长的时间（如24小时）
4. 点击 "确定"

## 验证任务
1. 在任务计划程序中找到 "ZMG Weekly Cleanup"
2. 右键选择 "运行" 测试任务
3. 检查 logs\cleanup.log 是否有新的执行记录

## 故障排除
- 如果任务没有运行，检查：
  1. 虚拟环境路径是否正确
  2. 批处理脚本是否有执行权限
  3. 日志文件路径是否可写

## 日志查看
清理日志保存在：
d:\MyOS\zmg_backend\logs\cleanup.log

可以使用以下命令查看最新日志：
type d:\MyOS\zmg_backend\logs\cleanup.log